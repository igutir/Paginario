{% extends "base.html" %}

{% block contenido %}

<div class="book-container">
    <div class="book-details">
        <div class="book-image">
            <img src="{{ libro.portada }}" alt="Imagen del libro">
        </div>
        <div class="book-info">
            <p class="year-author"><span>{{ libro.anio }}</span> · <span>{{ libro.id_autor.nombre }}</span></p>
            <h1 class="book-title">{{ libro.nombre }}</h1>
            <div class="categories">
                <span class="category">Categoría</span>
                <span class="category">Categoría</span>
            </div>

                    <!-- Calificación con estrellas -->
                    <div class="rating">
                        <i class="far fa-star" id="star1" onclick="rateBook(1)"></i>
                        <i class="far fa-star" id="star2" onclick="rateBook(2)"></i>
                        <i class="far fa-star" id="star3" onclick="rateBook(3)"></i>
                        <i class="far fa-star" id="star4" onclick="rateBook(4)"></i>
                        <i class="far fa-star" id="star5" onclick="rateBook(5)"></i>
                    </div>

            <p class="isbn">ISBN 9789564085937</p>
            <div class="book-icons">
                <a href="{% url 'agregar_favorito' libro.id %}"> <i class="fas fa-heart icon"></i></a>


                <!-- Dropdown de Bootstrap con íconos -->
                <div class="dropdown d-inline">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                        <i id="bookmark-icon" class="icon {% if estado_libro == 'Leido' %}fas fa-eye{% elif estado_libro == 'En progreso' %}fas fa-spinner{% elif estado_libro == 'En espera' %}fas fa-clock{% else %}fas fa-bookmark{% endif %}"></i>
                        <span id="estado-texto">
                            {% if estado_libro != 'None' %}
                                {{ estado_libro }}
                            {% else %}
                                Estado
                            {% endif %}
                        </span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <li><a class="dropdown-item" href="#" onclick="setEstado('leido', 'fas fa-eye', 'Leído', '{{ libro.id }}')"><i class="fas fa-eye"></i> Leído</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setEstado('progreso', 'fas fa-spinner', 'En progreso', '{{ libro.id }}')"><i class="fas fa-spinner"></i> En progreso</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setEstado('espera', 'fas fa-clock', 'En espera', '{{ libro.id }}')"><i class="fas fa-clock"></i> En espera</a></li>
                    </ul>
                </div>

                <i class="fas fa-list icon"></i>
            </div>
        </div>



        <!-- <div class="book-description">
            <p>Breve descripción del libro</p>
            <p>{{ libro.descripcion }}</p>
        </div> -->


        <div class="book-description">
            <p>Breve descripción del libro</p>
            <p id="descripcion">
                {{ libro.descripcion|slice:":200" }}<span id="dots">...</span><span id="more" style="display:none">{{ libro.descripcion|slice:"200:" }}</span>
            </p>
            <button onclick="toggleDescription()" id="readMoreBtn" class="btn btn-link">Leer más</button>
        </div>
    </div>

    <div class="reviews">
        <h2>RESEÑAS</h2>
        <div class="review">
            <div class="user-avatar"></div>
            <div class="review-content">
                <p class="review-author">NOMBRE</p>
                <p class="review-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque sagittis, justo ac consequat feugiat, ipsum nisi porttitor dolor...</p>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleFavorite(icon) {
        if (icon.classList.contains('active')) {
            icon.classList.remove('active');
            // Aquí puedes añadir la lógica para eliminar el libro de favoritos
            console.log("Libro eliminado de favoritos");
        } else {
            icon.classList.add('active');
            // Aquí puedes añadir la lógica para agregar el libro a favoritos
            console.log("Libro agregado a favoritos");
        }
    }

    function setEstado(estado, iconClass, textoEstado, id_libro) {
        // Cambiar el icono del bookmark
        var bookmarkIcon = document.getElementById('bookmark-icon');
        bookmarkIcon.className = iconClass + ' icon';

        // Cambiar el texto del estado
        var estadoTexto = document.getElementById('estado-texto');
        estadoTexto.innerText = textoEstado;

        console.log("Estado del libro cambiado a:", estado);
        // Aquí puedes agregar la lógica de actualización del estado en la base de datos

        window.location.href = id_libro+"/"+estado+"/";
    }

        // Función para manejar las estrellas de calificación
        function rateBook(rating) {
        for (let i = 1; i <= 5; i++) {
            const star = document.getElementById('star' + i);
            if (i <= rating) {
                star.classList.remove('far');
                star.classList.add('fas');
            } else {
                star.classList.remove('fas');
                star.classList.add('far');
            }
        }
        console.log("Calificación del libro: " + rating);
        // Aquí puedes agregar la lógica de guardado de calificación
    }


    // Función para el botón "Leer más"
    function toggleDescription() {
        var dots = document.getElementById("dots");
        var moreText = document.getElementById("more");
        var btnText = document.getElementById("readMoreBtn");

        if (dots.style.display === "none") {
            dots.style.display = "inline";
            btnText.innerHTML = "Leer más"; 
            moreText.style.display = "none";
        } else {
            dots.style.display = "none";
            btnText.innerHTML = "Leer menos"; 
            moreText.style.display = "inline";
        }
    }
</script>

{% endblock %}


